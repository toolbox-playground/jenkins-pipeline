pipeline:
  agent:
    any

  environment:
    NODE_ENV: 'development'

  stages:
    - stage: Install Dependencies
      steps:
        - sh: cd app && npm install

    - stage: Test
      steps:
        - sh: cd app && npm test

    - stage: Build
      steps:
        - sh: docker build -t nodejs .

    // - stage: Deploy
    //   when:
    //     branch: master
    //   steps:
    //     - sh: ./deploy.sh

  post:
    always:
      - junit: '**/test-results.xml'
    success:
      - archiveArtifacts: '**/build/**'
    failure:
      - mail:
          to: 'team@example.com'
          subject: 'Build Failed'
          body: 'The build has failed. Please check the Jenkins job for details.'

  tools:
    nodejs: 'NodeJS 18' # Ensure you have the NodeJS plugin installed and configured in Jenkins
